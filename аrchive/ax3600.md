# [AX3600](../README.md)

Xiaomi AX3600 is a router with Qualcomm IPQ8071A SoC, 4x 2.5GbE ports, 1x 2.5GbE WAN port, and 1x USB 3.0 port - ©️Copilot

- [TODO NixWRT someday](https://wiki.nixos.org/wiki/Networking_working_group)
  - <https://gti.telent.net/dan/liminix>
  - <https://git.eno.space/dewclaw.git/tree/openwrt>

## [OpenWrt](https://openwrt.org/toh/xiaomi/ax3600)

- [disable IPV6](https://3os.org/infrastructure/openwrt/disable-ipv6/)

### packets

- Installed
  - luci-app-pbr
    - [dnmasq-full](https://docs.openwrt.melmac.ca/pbr/1.1.8/#Howtoinstalldnsmasq-full)
    - [uci settings](https://docs.openwrt.melmac.ca/pbr/1.1.8/#Warning:Pleasesetdhcp.lan.force1)
    - [script to reload when WAN is down](https://docs.openwrt.melmac.ca/pbr/1.1.8/#AWordAboutInterfaceHotplugScript)
  - luci-app-sqm
  - luci-app-wol
  - luci-app-ddns
  - luci-proto-wireguard
  - iperf3
- Disabled
  - kmod-nf-nathelper-extra
    - to allow obsolete VPNs to work (from 4PDA openwrt version)

#### [luci-app-amneziawg](https://github.com/openwrt-xiaomi/awg-openwrt/wiki/AmneziaWG-installing#установка-amneziawg-на-openwrt-устройстве)

```shell
VERSION=$(grep '^DISTRIB_RELEASE=' /etc/openwrt_release | cut -d "'" -f 2)
PKGARCH=$(grep '^DISTRIB_ARCH=' /etc/openwrt_release | cut -d "'" -f 2)
TARGET=$(grep '^DISTRIB_TARGET=' /etc/openwrt_release | cut -d "'" -f 2)
SUBTARGET=$(echo $TARGET | cut -d "/" -f 2)
TARGET=$(echo $TARGET | cut -d "/" -f 1)
PKGPOSTFIX="_v${VERSION}_${PKGARCH}_${TARGET}_${SUBTARGET}.ipk"
BASE_URL="https://github.com/Slava-Shchipunov/awg-openwrt/releases/download/v${VERSION}/"

for pkg in amneziawg-tools kmod-amneziawg luci-app-amneziawg; do
  wget $BASE_URL$pkg$PKGPOSTFIX -O ./${pkg}$PKGPOSTFIX
  opkg install ./${pkg}$PKGPOSTFIX
  rm ./${pkg}$PKGPOSTFIX
done
```

##### [fix `proto_amneziawg_check_installed` error](https://github.com/amnezia-vpn/amneziawg-openwrt/issues/7)

```shell
sed -i 's/\tproto_amneziawg_check_installed/\t# proto_amneziawg_check_installed/g' /overlay/upper/lib/netifd/proto/amneziawg.sh
# or (untested)
sed -i '/\tproto_amneziawg_check_installed/s/^\t/^\t#/g' /overlay/upper/lib/netifd/proto/amneziawg.sh
```

### [white IP](https://4pda.to/forum/index.php?s=&showtopic=1013678&view=findpost&p=109028697) ([alt](https://habr.com/ru/sandbox/99949/))

#### `vi /etc/hotplug.d/iface/26-white-ip-miner`

```shell
#!/bin/sh
if [ "$ACTION" = "ifup" -a "$INTERFACE" = "wan" ]; then
    . /lib/functions/network.sh; network_get_ipaddr ip wan
    _ip=$(echo $ip | grep -v -E "(^100\.6[4-9]\.|^100\.[7-9][0-9]\.|^100\.1[0-1][0-9]\.|^100\.12[0-7]\.)")
    [ -z "$_ip" ] &&   logger -t white-ip-miner "Reloading wan due grey IP - $ip" && ifup wan
    [ ! -z "$_ip" ] && logger -t white-ip-miner "White IP taken!           - $ip"
fi
```
